<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Roadmap: From Developer to Leader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The application is structured as a three-part interactive journey, mirroring the roadmap's phases. A tab-based navigation allows users to move between phases without excessive scrolling. This chunking of information enhances focus. Key interactions include a dynamic self-assessment table in Phase 1 where users click to rate themselves, a definitive choice between 'Scrum Master' and 'Team Leader' tracks that conditionally renders the content for Phase 2, and interactive checklists throughout to foster a sense of progress and accomplishment. A new sharing feature creates a read-only snapshot for others to view. -->
    <!-- Visualization & Content Choices: The roadmap is presented using a combination of interactive components built with HTML, Tailwind CSS, and vanilla JavaScript. Info -> Goal -> Method -> Interaction -> Justification. 1. Self-Assessment -> Inform/Interact -> HTML Table -> JS click events to change cell color -> Provides immediate visual feedback and personalizes the assessment. 2. Phase Progression -> Organize/Navigate -> HTML Buttons -> JS to toggle section visibility -> Creates a clean, single-page app feel without page reloads. 3. Track Selection -> Interact/Filter -> HTML Buttons -> JS to set a state variable and conditionally display content -> Tailors the roadmap to the user's chosen career path. 4. Task Tracking -> Motivate/Track -> HTML Checkboxes -> JS to update a visual progress bar -> Gamifies the process and visually represents completion. All visual elements are created with structured HTML/CSS, adhering to the NO SVG/Mermaid constraint. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .phase-content {
            display: none;
        }
        .phase-content.active {
            display: block;
        }
        .nav-button.active {
            background-color: #1e40af; /* blue-800 */
            color: white;
        }
        .skill-rating-cell {
            cursor: pointer;
            transition: background-color: 0.2s;
        }
        .skill-rating-cell.read-only {
            cursor: default;
        }
        .skill-rating-cell.selected {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            font-weight: bold;
        }
        .track-button.selected {
            background-color: #166534; /* green-800 */
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 14px 0 rgba(0, 118, 255, 0.39);
        }
        .task-checkbox:checked + label {
            text-decoration: line-through;
            color: #6b7280; /* gray-500 */
        }
        #loader, #share-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
        }
        #share-modal, #share-menu {
            display: none;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-stone-100 text-stone-800">

    <div id="loader" class="flex justify-center items-center">
        <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"></div>
    </div>
    
    <div id="share-modal-overlay" class="flex justify-center items-center">
        <div id="share-modal" class="bg-white p-8 rounded-2xl shadow-2xl max-w-lg w-full mx-4">
            <h3 id="share-modal-title" class="text-2xl font-bold text-stone-800 mb-4">Share Your Progress</h3>
            <p id="share-modal-text" class="text-stone-600 mb-4">Copy the link below to share a version of your roadmap.</p>
            <input id="share-link-input" type="text" readonly class="w-full p-2 border border-stone-300 rounded-lg bg-stone-50 mb-4">
            <div class="flex justify-end gap-4">
                <button id="copy-share-link" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">Copy</button>
                <button id="close-share-modal" class="px-6 py-2 bg-stone-200 text-stone-800 font-semibold rounded-lg hover:bg-stone-300 transition-colors">Close</button>
            </div>
        </div>
    </div>


    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        <header class="text-center mb-4">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-900">Your Leadership Journey</h1>
            <p class="mt-2 text-lg text-stone-600">An Interactive Roadmap from Developer to Leader</p>
            <div id="auth-status" class="mt-2 text-sm text-stone-500">Connecting...</div>
        </header>
        
        <div id="main-controls" class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center">
                 <h2 class="text-xl font-semibold text-stone-700">Your Progress</h2>
                 <div class="relative">
                     <button id="share-button-toggle" class="px-5 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors shadow-sm flex items-center">
                         Share
                         <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                     </button>
                     <div id="share-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10">
                         <a href="#" id="share-read-only" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100">Share (Read-Only)</a>
                         <a href="#" id="share-write" class="block px-4 py-2 text-sm text-stone-700 hover:bg-stone-100">Share (Write Access)</a>
                     </div>
                 </div>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 mt-3">
                <div id="progressBar" class="bg-blue-600 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <p id="progressText" class="text-right text-sm mt-1 text-stone-500">0% Complete</p>
        </div>

        <main class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
            <nav class="flex flex-wrap justify-center border-b border-stone-200 mb-6">
                <button id="nav-phase1" class="nav-button py-3 px-6 text-lg font-medium text-stone-600 hover:bg-blue-100 rounded-t-lg transition-colors" data-phase="phase1">Phase 1: Foundation</button>
                <button id="nav-phase2" class="nav-button py-3 px-6 text-lg font-medium text-stone-600 hover:bg-blue-100 rounded-t-lg transition-colors" data-phase="phase2">Phase 2: Application</button>
                <button id="nav-phase3" class="nav-button py-3 px-6 text-lg font-medium text-stone-600 hover:bg-blue-100 rounded-t-lg transition-colors" data-phase="phase3">Phase 3: The Move</button>
            </nav>

            <div id="phase1" class="phase-content">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-blue-800">Foundation & Self-Assessment</h2>
                    <p class="mt-2 text-stone-600 max-w-3xl mx-auto">Months 1-3: Build a strong theoretical understanding of both roles and determine which path best aligns with your skills and career aspirations.</p>
                </div>
                
                <div class="space-y-8">
                    <section>
                        <h3 class="text-2xl font-semibold text-stone-700 mb-4 border-l-4 border-blue-500 pl-4">1. Deep Dive into Theory</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-stone-50 p-6 rounded-lg">
                                <h4 class="font-bold text-lg mb-3">Core Reading for All Leaders</h4>
                                <ul class="space-y-2 list-disc list-inside text-stone-700">
                                    <li>The Scrum Guide</li>
                                    <li>"The Phoenix Project"</li>
                                    <li>"Drive" by Daniel Pink</li>
                                    <li>"Crucial Conversations"</li>
                                </ul>
                            </div>
                            <div class="bg-stone-50 p-6 rounded-lg">
                                <h4 class="font-bold text-lg mb-3">Role-Specific Reading</h4>
                                <p class="mb-2"><strong>For Aspiring Scrum Masters:</strong> "Scrum Mastery", "Coaching Agile Teams"</p>
                                <p><strong>For Aspiring Team Leaders:</strong> "The Making of a Manager", "Radical Candor"</p>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-2xl font-semibold text-stone-700 mb-4 border-l-4 border-blue-500 pl-4">2. Observe and Learn</h3>
                         <div class="bg-stone-50 p-6 rounded-lg">
                            <ul class="space-y-3 list-disc list-inside text-stone-700">
                                <li><strong>Shadowing:</strong> Ask to shadow a current Scrum Master and a Team Leader. Observe how they facilitate, handle conflicts, and communicate.</li>
                                <li><strong>Informational Interviews:</strong> Schedule 30-minute chats with leaders. Ask about their journey, challenges, and what they look for in a new leader.</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-2xl font-semibold text-stone-700 mb-4 border-l-4 border-blue-500 pl-4">3. Conduct a Self-Assessment</h3>
                        <p class="mb-4 text-stone-600">Honestly evaluate your current skills. Click on a number (1=Needs Development, 5=Expert) to rate yourself and see where to focus your growth.</p>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="bg-stone-100">
                                        <th class="p-3 font-semibold">Skill/Competency</th>
                                        <th class="p-3 font-semibold text-center" colspan="5">Your Current Skill (1-5)</th>
                                    </tr>
                                </thead>
                                <tbody id="assessment-table">
                                    <!-- Rows will be injected by JS -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <section id="path-selection-section" class="text-center bg-blue-50 p-8 rounded-lg">
                        <h3 class="text-2xl font-bold text-blue-800">End of Phase 1 Goal: Choose Your Path</h3>
                        <p class="mt-2 mb-6 text-stone-600">Based on your learning and self-assessment, which role excites you more? Your choice will tailor the next phase of your roadmap.</p>
                        <div class="flex justify-center gap-4">
                            <button class="track-button text-lg font-semibold py-3 px-8 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-300 shadow-md" data-track="scrum-master">Scrum Master</button>
                            <button class="track-button text-lg font-semibold py-3 px-8 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-300 shadow-md" data-track="team-leader">Team Leader</button>
                        </div>
                    </section>
                </div>
            </div>

            <div id="phase2" class="phase-content">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-blue-800">Practical Application & Skill Building</h2>
                    <p class="mt-2 text-stone-600 max-w-3xl mx-auto">Months 4-9: Move from theory to practice. Actively seek opportunities to develop and demonstrate leadership skills within your current role.</p>
                </div>

                <div id="phase2-content" class="hidden">
                    <div id="scrum-master-track" class="track-content hidden space-y-6">
                        <h3 class="text-2xl font-semibold text-center text-stone-700">Track A: Aspiring Scrum Master</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-sm1" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-sm1" class="font-bold">Get Certified (CSM or PSM I)</label><p class="pl-8 text-stone-600">Provides a structured learning path and a valuable credential.</p></div>
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-sm2" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-sm2" class="font-bold">Volunteer to Facilitate</label><p class="pl-8 text-stone-600">Facilitate a Sprint Retrospective or backlog refinement session.</p></div>
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-sm3" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-sm3" class="font-bold">Become the Impediment Hunter</label><p class="pl-8 text-stone-600">Document things slowing the team down and start conversations to solve them.</p></div>
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-sm4" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-sm4" class="font-bold">Coach a Teammate</label><p class="pl-8 text-stone-600">Mentor a new developer or intern on your team's Agile practices.</p></div>
                        </div>
                    </div>
                    <div id="team-leader-track" class="track-content hidden space-y-6">
                        <h3 class="text-2xl font-semibold text-center text-stone-700">Track B: Aspiring Team Leader</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-tl1" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-tl1" class="font-bold">Find a Mentor</label><p class="pl-8 text-stone-600">Formalize a mentorship relationship with a respected Team Leader.</p></div>
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-tl2" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-tl2" class="font-bold">Lead a Technical Initiative</label><p class="pl-8 text-stone-600">Lead the design and implementation of a new feature.</p></div>
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-tl3" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-tl3" class="font-bold">Practice One-on-Ones</label><p class="pl-8 text-stone-600">Help with mentoring an intern or junior developer.</p></div>
                            <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-tl4" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-tl4" class="font-bold">Own Stakeholder Communication</label><p class="pl-8 text-stone-600">Present a demo or a technical update to a product manager.</p></div>
                        </div>
                    </div>
                </div>
                <div id="phase2-placeholder" class="text-center text-stone-500 p-10 bg-stone-50 rounded-lg">
                    <p>Please complete Phase 1 and choose your career track to see the next steps.</p>
                </div>
            </div>

            <div id="phase3" class="phase-content">
                 <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-blue-800">Gaining Visibility & Making the Move</h2>
                    <p class="mt-2 text-stone-600 max-w-3xl mx-auto">Months 10-12+: Solidify your experience, communicate your ambitions, and position yourself as a strong candidate for a leadership role.</p>
                </div>
                <div class="space-y-4">
                    <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-p3-1" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-p3-1" class="font-bold text-lg">1. Build Your "Leadership Portfolio"</label><p class="pl-8 text-stone-600">Document your leadership experiences, focusing on impact. E.g., "Facilitated 5 team retrospectives, leading to a new code review checklist that reduced bugs by 15%."</p></div>
                    <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-p3-2" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-p3-2" class="font-bold text-lg">2. Communicate Your Intent</label><p class="pl-8 text-stone-600">Schedule a formal career development conversation with your manager. Present your portfolio and state your goal.</p></div>
                    <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-p3-3" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-p3-3" class="font-bold text-lg">3. Take on a Stretch Assignment</label><p class="pl-8 text-stone-600">Actively seek a project that will test your leadership skills, like leading a cross-team initiative.</p></div>
                    <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-p3-4" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-p3-4" class="font-bold text-lg">4. Update Your Resume and LinkedIn</label><p class="pl-8 text-stone-600">Reframe your experience to highlight leadership, communication, and facilitation skills.</p></div>
                    <div class="bg-stone-50 p-6 rounded-lg"><input type="checkbox" id="task-p3-5" class="task-checkbox h-5 w-5 mr-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500"><label for="task-p3-5" class="font-bold text-lg">5. Prepare for Interviews</label><p class="pl-8 text-stone-600">Practice answering behavioral questions using the STAR method. Be ready to discuss your leadership philosophy.</p></div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBBs9rnAX_6St8fqwO7avZsBT9KC3VCDTM",
            authDomain: "interactive-roadmap-app.firebaseapp.com",
            projectId: "interactive-roadmap-app",
            storageBucket: "interactive-roadmap-app.firebasestorage.app",
            messagingSenderId: "451483669116",
            appId: "1:451483669116:web:111e984a88679249e62ff9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userId = null;
        let dbRef = null;
        let mode = 'private'; // 'private', 'readOnly', or 'collaborative'
        let collabId = null;

        const loader = document.getElementById('loader');
        const authStatus = document.getElementById('auth-status');
        const navButtons = document.querySelectorAll('.nav-button');
        const phaseContents = document.querySelectorAll('.phase-content');
        const trackButtons = document.querySelectorAll('.track-button');
        const assessmentTableBody = document.getElementById('assessment-table');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const allTasks = document.querySelectorAll('.task-checkbox');
        
        const shareButtonToggle = document.getElementById('share-button-toggle');
        const shareMenu = document.getElementById('share-menu');
        const shareReadOnlyButton = document.getElementById('share-read-only');
        const shareWriteButton = document.getElementById('share-write');
        
        const shareModalOverlay = document.getElementById('share-modal-overlay');
        const shareModal = document.getElementById('share-modal');
        const shareModalTitle = document.getElementById('share-modal-title');
        const shareModalText = document.getElementById('share-modal-text');
        const shareLinkInput = document.getElementById('share-link-input');
        const copyShareLinkButton = document.getElementById('copy-share-link');
        const closeShareModalButton = document.getElementById('close-share-modal');


        let chosenTrack = null;

        const assessmentSkills = [
            { name: 'Facilitation', description: 'Guiding meetings to productive outcomes without dominating them.' },
            { name: 'Active Listening', description: 'Truly hearing and understanding team members\' concerns and ideas.' },
            { name: 'Conflict Resolution', description: 'Mediating disagreements to find constructive, positive solutions.' },
            { name: 'Giving Feedback', description: 'Delivering constructive criticism and praise effectively to foster growth.' },
            { name: 'Delegation', description: 'Trusting the team and empowering them with ownership.' },
            { name: 'Strategic Thinking', description: 'Seeing the bigger picture beyond the current sprint or task.' },
            { name: 'Influencing Others', description: 'Inspiring action and buy-in without relying on formal authority.' }
        ];

        function getCurrentProgress() {
            const skillRatings = {};
            document.querySelectorAll('.skill-rating-cell.selected').forEach(cell => {
                skillRatings[cell.dataset.skill] = cell.dataset.rating;
            });

            const completedTasks = [];
            document.querySelectorAll('.task-checkbox:checked').forEach(task => {
                completedTasks.push(task.id);
            });

            return {
                skillRatings: skillRatings,
                chosenTrack: chosenTrack,
                completedTasks: completedTasks,
                createdAt: new Date().toISOString()
            };
        }

        async function saveProgress() {
            if (mode === 'readOnly') return;
            loader.style.display = 'flex';
            
            const progress = getCurrentProgress();
            
            try {
                if (mode === 'collaborative' && collabId) {
                    const collabRef = doc(db, "collaborativeProgress", collabId);
                    await setDoc(collabRef, progress, { merge: true });
                } else if (mode === 'private' && userId) {
                    await setDoc(dbRef, progress, { merge: true });
                }
            } catch (error) {
                console.error("Error saving progress: ", error);
                authStatus.textContent = 'Error saving progress.';
            } finally {
                loader.style.display = 'none';
            }
        }

        async function loadProgress(data) {
            const progress = data;
            
            if (progress.skillRatings) {
                for (const skillName in progress.skillRatings) {
                    const rating = progress.skillRatings[skillName];
                    const cell = document.querySelector(`.skill-rating-cell[data-skill="${skillName}"][data-rating="${rating}"]`);
                    if (cell) {
                        cell.classList.add('selected');
                    }
                }
            }

            if (progress.chosenTrack) {
                chosenTrack = progress.chosenTrack;
                const trackButton = document.querySelector(`.track-button[data-track="${chosenTrack}"]`);
                if (trackButton) {
                    trackButtons.forEach(btn => btn.classList.remove('selected'));
                    trackButton.classList.add('selected');
                    document.getElementById('phase2-placeholder').classList.add('hidden');
                    document.getElementById('phase2-content').classList.remove('hidden');
                    document.querySelectorAll('.track-content').forEach(content => content.classList.add('hidden'));
                    document.getElementById(`${chosenTrack}-track`).classList.remove('hidden');
                }
            }
            
            if (progress.completedTasks) {
                progress.completedTasks.forEach(taskId => {
                    const taskCheckbox = document.getElementById(taskId);
                    if (taskCheckbox) {
                        taskCheckbox.checked = true;
                    }
                });
            }
            updateProgressBar();
        }

        function populateAssessmentTable() {
            assessmentSkills.forEach(skill => {
                const row = document.createElement('tr');
                row.className = 'border-t border-stone-200';
                let cells = `<td class="p-3"><p class="font-semibold">${skill.name}</p><p class="text-sm text-stone-500">${skill.description}</p></td>`;
                for (let i = 1; i <= 5; i++) {
                    cells += `<td class="p-3 text-center skill-rating-cell hover:bg-blue-200" data-skill="${skill.name}" data-rating="${i}">${i}</td>`;
                }
                row.innerHTML = cells;
                assessmentTableBody.appendChild(row);
            });

            document.querySelectorAll('.skill-rating-cell').forEach(cell => {
                cell.addEventListener('click', function() {
                    if (mode === 'readOnly') return;
                    const skillName = this.dataset.skill;

                    if(this.classList.contains('selected')) {
                        this.classList.remove('selected');
                    } else {
                        document.querySelectorAll(`.skill-rating-cell[data-skill="${skillName}"]`).forEach(c => c.classList.remove('selected'));
                        this.classList.add('selected');
                    }
                    saveProgress();
                });
            });
        }

        function showPhase(phaseId) {
            phaseContents.forEach(content => content.classList.remove('active'));
            navButtons.forEach(button => button.classList.remove('active'));

            document.getElementById(phaseId).classList.add('active');
            document.querySelector(`.nav-button[data-phase="${phaseId}"]`).classList.add('active');
        }

        navButtons.forEach(button => {
            button.addEventListener('click', function() {
                showPhase(this.dataset.phase);
            });
        });

        trackButtons.forEach(button => {
            button.addEventListener('click', function() {
                if(mode === 'readOnly') return;
                chosenTrack = this.dataset.track;
                
                trackButtons.forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');

                document.getElementById('phase2-placeholder').classList.add('hidden');
                document.getElementById('phase2-content').classList.remove('hidden');
                
                document.querySelectorAll('.track-content').forEach(content => content.classList.add('hidden'));
                document.getElementById(`${chosenTrack}-track`).classList.remove('hidden');
                
                updateProgressBar();
                saveProgress();
                
                setTimeout(() => showPhase('phase2'), 300);
            });
        });
        
        function updateProgressBar() {
            const phase2Tasks = chosenTrack ? document.querySelectorAll(`#${chosenTrack}-track .task-checkbox`) : [];
            const phase3Tasks = document.querySelectorAll('#phase3 .task-checkbox');
            
            const relevantTasks = [...phase2Tasks, ...phase3Tasks];
            const totalTasks = relevantTasks.length;
            
            if (totalTasks === 0) {
                progressBar.style.width = '0%';
                progressText.textContent = '0% Complete';
                return;
            };

            const completedTasks = relevantTasks.filter(task => task.checked).length;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${percentage}% Complete`;
        }

        allTasks.forEach(task => {
            task.addEventListener('change', () => {
                if(mode === 'readOnly') return;
                updateProgressBar();
                saveProgress();
            });
        });
        
        function setupReadOnlyMode() {
            mode = 'readOnly';
            document.getElementById('main-controls').style.display = 'none';
            document.getElementById('path-selection-section').style.display = 'none';
            document.querySelectorAll('.task-checkbox').forEach(cb => cb.disabled = true);
            document.querySelectorAll('.skill-rating-cell').forEach(cell => cell.classList.add('read-only'));
            authStatus.textContent = "Viewing a shared roadmap.";
        }
        
        function setupCollaborativeMode() {
            mode = 'collaborative';
            document.getElementById('main-controls').style.display = 'none';
            authStatus.textContent = "You are editing a collaborative roadmap.";
        }

        async function handlePageLoad() {
            populateAssessmentTable();
            showPhase('phase1');

            const urlParams = new URLSearchParams(window.location.search);
            const snapshotId = urlParams.get('view');
            collabId = urlParams.get('collab');

            if (snapshotId) {
                setupReadOnlyMode();
                loader.style.display = 'flex';
                try {
                    const snapshotRef = doc(db, "sharedProgress", snapshotId);
                    const docSnap = await getDoc(snapshotRef);
                    if (docSnap.exists()) {
                        await loadProgress(docSnap.data());
                    } else {
                        authStatus.textContent = "Shared roadmap not found.";
                    }
                } catch (error) {
                    console.error("Error loading snapshot:", error);
                    authStatus.textContent = "Could not load shared roadmap.";
                } finally {
                    loader.style.display = 'none';
                }
            } else if (collabId) {
                setupCollaborativeMode();
                loader.style.display = 'flex';
                try {
                    const collabRef = doc(db, "collaborativeProgress", collabId);
                    const docSnap = await getDoc(collabRef);
                    if (docSnap.exists()) {
                        await loadProgress(docSnap.data());
                    } else {
                        authStatus.textContent = "Collaborative roadmap not found.";
                    }
                } catch (error) {
                    console.error("Error loading collaborative doc:", error);
                    authStatus.textContent = "Could not load collaborative roadmap.";
                } finally {
                    loader.style.display = 'none';
                }
            } else {
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        dbRef = doc(db, "userProgress", userId);
                        authStatus.textContent = `Connected! Your progress is saved online.`;
                        loader.style.display = 'flex';
                        getDoc(dbRef).then(docSnap => {
                            if (docSnap.exists()) {
                                loadProgress(docSnap.data());
                            } else {
                                authStatus.textContent = 'Welcome! Start your roadmap to save progress.';
                            }
                        }).catch(error => {
                            console.error("Error loading progress: ", error);
                            authStatus.textContent = 'Could not load saved data.';
                        }).finally(() => {
                            loader.style.display = 'none';
                        });
                    } else {
                        signInAnonymously(auth).catch((error) => {
                            console.error("Anonymous sign-in failed: ", error);
                            authStatus.textContent = 'Connection failed. Progress will not be saved.';
                        });
                    }
                });
            }
        }
        
        function openShareModal(title, text, url) {
            shareModalTitle.textContent = title;
            shareModalText.textContent = text;
            shareLinkInput.value = url;
            shareModalOverlay.style.display = 'flex';
            shareModal.style.display = 'block';
        }

        shareReadOnlyButton.addEventListener('click', async (e) => {
            e.preventDefault();
            shareMenu.style.display = 'none';
            loader.style.display = 'flex';
            const progress = getCurrentProgress();
            try {
                const docRef = await addDoc(collection(db, "sharedProgress"), progress);
                const snapshotId = docRef.id;
                const shareUrl = `${window.location.origin}${window.location.pathname}?view=${snapshotId}`;
                openShareModal('Share Read-Only Link', 'Anyone with this link can view a snapshot of your progress.', shareUrl);
            } catch (error) {
                console.error("Error creating read-only share link: ", error);
                alert("Could not create share link. Please try again.");
            } finally {
                loader.style.display = 'none';
            }
        });
        
        shareWriteButton.addEventListener('click', async (e) => {
            e.preventDefault();
            shareMenu.style.display = 'none';
            loader.style.display = 'flex';
            const progress = getCurrentProgress();
            try {
                const docRef = await addDoc(collection(db, "collaborativeProgress"), progress);
                const collabId = docRef.id;
                const shareUrl = `${window.location.origin}${window.location.pathname}?collab=${collabId}`;
                openShareModal('Share Write Access Link', 'Anyone with this link can edit this version of the roadmap.', shareUrl);
            } catch (error) {
                console.error("Error creating write access share link: ", error);
                alert("Could not create share link. Please try again.");
            } finally {
                loader.style.display = 'none';
            }
        });

        closeShareModalButton.addEventListener('click', () => {
            shareModalOverlay.style.display = 'none';
            shareModal.style.display = 'none';
        });

        copyShareLinkButton.addEventListener('click', () => {
            shareLinkInput.select();
            document.execCommand('copy');
            copyShareLinkButton.textContent = 'Copied!';
            setTimeout(() => {
                copyShareLinkButton.textContent = 'Copy';
            }, 2000);
        });
        
        shareButtonToggle.addEventListener('click', () => {
            shareMenu.style.display = shareMenu.style.display === 'block' ? 'none' : 'block';
        });
        
        document.addEventListener('click', (e) => {
            if (!shareButtonToggle.contains(e.target) && !shareMenu.contains(e.target)) {
                shareMenu.style.display = 'none';
            }
        });

        handlePageLoad();
    </script>
</body>
</html>
```

---
### **Important Reminder**

For this to work, you will need to update your **Firestore Security Rules** to allow for the new "collaborative" mode. Please use the rules I provided in the previous response. Without that update, the "Share (Write Access)" feature will be blocked by the databa
